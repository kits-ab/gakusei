package se.kits.gakusei.kanjiclient.service;

import org.springframework.http.*;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;
import se.kits.gakusei.kanjiclient.dto.KanjiDrawingDTO;

import java.awt.*;
import java.io.*;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
import java.util.ArrayList;
import java.util.Date;


@Component
public class KanjiService {

    //private static final String REST_SERVICE_URI = "https://gakusei.daigaku.se";
    private static final String REST_SERVICE_URI = "https://staging.daigaku.se";
    //private static final String REST_SERVICE_URI = "http://localhost:8080";

    /*Hardcoded dummy data. The data represents '1' in japanese.*/
    private String data = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlgAAAJYCAYAAAC+ZpjcAAAgAElEQVR4Xu3dWYxd933Y8d+5y+xcJFuStdSWF0KmNJJiV2rrtkDkFK0jFwploLSRCGkNFDUQI8hTgT74wfVT0YcCLdAUMFCkgJ20qQS4glEYTuFGqoOoS+qooilFS2RTsiRLokxSJIez3LnnFP/rufTVaEhx+c3+uQAhLsPf3Pncn8Gvzzn3TBUeBAgQIECAAAECqQJV6jTDCBAgQIAAAQIEQmBZAgIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAgAABAgLLDhAgQIAAAQIEkgUEVjKocQQIECBAgAABgWUHCBAgQIAAAQLJAgIrGdQ4AgQIECBAgIDAsgMECBAgQIAAgWQBgZUMahwBAgQIECBAQGDZAQIECBAgQIBAsoDASgY1jgABAgQIECAgsOwAAQIECBAgQCBZQGAlgxpHgAABAgQIEBBYdoAAAQIECBAgkCwgsJJBjSNAgAABAgQICCw7QIAAAQIECBBIFhBYyaDGESBAgAABAgQElh0gQIAAAQIECCQLCKxkUOMIECBAYPcJPPbYY509e/ZMdzqdmaqqZjqdzv66rv92VVVv13V9rKqq5aLSNM1NVVXd1DTNC+XPVqTGmqb5tYi4oaqqpyPi5Yj4eET8g4i4NiJeaJrmu1VV3VZV1b1N03wgIl6LiCeqqnqlaZpfjYgDEfFSRPyXiPhxRCxGxPsiYiwi/jQiTkbE2aZpzj777LOnP//5z/d336u0sV+xwNpYb5+NAAECBDZRoGma1nPPPTdd1/VMRMz0er09rVbrb0XERET8tGmaTkT8laqqHoiIT0bEWxHxf1dC51Ob+NQ37FM3TfPHrVbrsaZpmqqq9jRN8+cTExPfPXDgwOkNexI74BMJrB3wIvoSCBAgsNMEyr/tR44cmWq1WoMQKkeFmqb5q03T3BwRr7RarX7TNNdFRDl6c19EnKmq6ujKUZr7d5rHFvx66oj4g6ZpvlHX9V/cfffdr1VV1WzB57lpT0lgbRq9T0yAAIGdK/Dwww+3P/KRj5RTZSWQyqmz/U3T/PLKV/x6RHSrqjrQNM2hiDgYEUsRUQKpHDXaEY/JN9+85K+jOzcX5cfVPupuNxauuWbNMeXPFi/wZ1f7eSNivmmaH1VV9WRVVd955plnHt7tpyEFVsJWGUGAAIGdKlBOqR05cuT97Xb7QF3Xf6eqqlNN0/ysRFOr1fpU0zSfi4h9EVFOH/0oIn5pK1u0lpZi/NSpdz3FiZMno9Xrvev3x8vvL5X2e/dj6jICaqualODqd7vl2rDBf+f37Rv8fLndjrk9e6JumpibmYmlVivqun7Hj/Jx5fc6nU7s27cvZmZKS59/PFZV1a/Nzs6e3apf+3o/L4G13sLmEyBAYIsIHD16tFzwPDjl1jTNdDnFVlXVb0TEbRHxk3J6LSJ+a4s83fNPY60oWh1Eg485Wa7j/sUj66jQVvPYrOdzvNeL40tLMVfXcWxhIc71+z//78qvZ2dn4wtf+MLo0/vGnXfe+Y826/lu9ucVWJv9Cvj8BAgQuAqBp5566pPtdnuq3+8vt9vtW5qmKRdnl3/lxpumOd7v9xebprll9dGH8uvhEYi1/uxCRyuu5GOne72YXl6OphwBaZrYs7wce1Y+f3kOe+s69jXN4PmUR/n5/qsw8Vc3R2Cu34/vnDgRd//O7wyfQF3X9cfuvvvu8q7GXfcQWLvuJfcFEyCwFQQOHz48s7i4eHOn07mpruubq6q6eWJi4mOdTudjY2NjHx7GT7vdnhkfH3/fpYTN6mgaBkvG1zvdbseHxsfPj7pubCyu63bP//qOqanzP59qt+PWifKmvN39eObcuUsGKEeGyhGiq31czH661YoPbcDr8ui+fXH7Zz87/FIeuPPOO//r1X5d2/HvC6zt+Kp5zgQIbFmBr371q62XX3751qmpqY9GxIf7/f4HI+LWbrc7Oz8/v3d+fn56aWlpf6/XK6frNuVR4meq1Rp87ouFUvnHuITVTnoMT2et/pqGp7zW+v1ySmytxzMJF6Vvtu3t09Pnn0IJsGEYl3guu1Eeo/tyKc/33x4/Hn9v5ShWVVW/Pjs7+4eX8vd22scIrJ32ivp6CBBYF4Ennnhi8rnnnrvtzJkzd/R6vYPdbvdXIuLeM2fOdE6dOtU7ffp0Mzc3N3b27MZe03uhWCr/QF4/coRp9B/SdQFa56GrjwatDqJyeurYYrm35i8ew2uE1vmp7Zrxg11rtwd7NQiwlQgb/rxAlNfpa8eOxZe//OW48cYbm7quP3j33Xe/smuQRr7QzQ6sOyNib0SU97K+sBtfAF8zAQKbJ1Au+m6a5objx49/8I033rij3+//atM0n5mbm5t6++23eydPnjw3Pz+/78yZM3H69OlYXh7cjHvdHqOn4Vaf6hk9BbfdYmn1UaPVp8PKqbE3R06PCaN1W7ENG/yVr3wlxsfHv33XXXeV23DsysdmBlY5Llne0nt9RPzTiPhXu/IV8EUTIJAqUO6/NDs7e335diL9fv8Dx48f/+zi4uIX5ubmrivRdOLEiZMLCwvXl2AahtP8/HzqcxgOu1Awld+/deV6pu10vdLoUaTVkVSOKI2eStsJp8/WZSl2wdCPf/zj8dBDDz07MTHx13fz3d83M7D+cUT8+5Vd++2I+N1dsHe+RAIErkBgeC+mqqrK92r7QNM0n1xYWPgnZ8+e/ejp06frt9566/XFxcWbRqNp+PPMC73LU7995GLu4ZGk7RZML43E0OqjRU+PXJiddeH1Fbzk/so2Fjh06NA377333i/v5ntglZdvMwKrnBL8YkT8m5H9EVjb+H9MnjqBKxU4evRo+Ua25RvX3lDX9R3lgth+v/83z5w505w4ceLV+fn5W0oorRVOSxe4+ePlPpfR60dGL/gu15uUi37LYytf7D0aS6NBtPqaJEeULnczfPwVCJS3TX7l0Ucf/ddX8Hd33F/ZqMAq30iz3Gzspoj4+2soCqwdt1q+oF0qUH3961//QKfTubXT6Xyw0+kcmJqa+my73f5UCaL5+fmf1XX9vl6vF+XX5b/D03TD/84lvDNr9MLv4YW55fUYXse0lU/LjZ6GG42i0SNLg6jq93fpivmykwXKzcfKxYXlR1mqwc+rqlqu67pf/jv65+XXTdOs/vjjEfFYXdd/+u1vf/vJ5Oe3bcdtVGA9FBG/fxElgbVtV8gT324CX/ziFyfefvvt6V6vN93tdsvdvKfqui7f9qRcFzlV7vBdVdX5n7daral2u72v2+2+v9vtXtNut68ZHx+/pd1uX7e8vFwtLi7WvV6vWvlx/maR2S6j0bTWqbnVtxvI/vxXOm8YTBc7Fefo0pXqXtHfG0bE+ZgYDYthaJSIGImLwcdeLDrquh5+/PmPLXNHfn8QMMOZZX7TNINfr0TL4OdrzSm/N3yOK39/8LHl5rKjvy4/b7Vay0tLS4M/Lz8vn6Pdbpeb0C6fO3duEE2dTmd5YmJi+fbbb1/+2te+tvY9KK6I1l8aFdiowLo1Iv5ZRCyMfPL3RcRvrvxaYNlLAisCX/rSl7pvvvnm9PLy8vT4+Hi5Q/cgfkoElQAq8VMiaPjz0SgqsVS+R9zKj3f9vKqqElC/uDvkJquPnp7bLtE0ekruQkeYtlIwVVVV/sHvrxx1KHeyvOgRiuGfD//xHz16cbHoGAbIMFAuFAsXi45hSAyjYxgew+goz6lEQ/n98hgGy/D3yq+XlpbeERbdbnd5enp6+Yc//GH/Bz/4Qfk7P79dvAeBdRbYqMBa68so0TW8fb7AWucX2vg8gXIjySeffHIQOJ1OZ7oEUImfTqdz/kjQaAANo2cljC4lgLb1LbBHo2k7nJ4bvYXA6FGm0VsHrNcpubGxsdi7d+/gx549e97x3+mf3wBy6cyZM4/0+/2TExMT5VvfnHnllVcef/nll1998cUXT44eoShHJcbGxpaPHz8+OGIxMzOz/MgjjziPmPc/fZMIXJbAZgbWgYh43hGsy3q9fPAlChw+fHhyYWFhcAqsBFCJnHa7PQih4amw4c/Ln60+LTY8RbbG0aBhIF3iM9kZHzZ6u4ELXQi+le7NNPimtCv3VRq9IeXorQTW8yhTVVXnY2lmZqa3f//+bgmo6enpM61W60/Gxsb+94033vjGtddeu6d8z8CI+KNOp/PjgwcP/mxnbIyvggABgWUHNkXg8OHDY+fOnSunwAbxUyJoGEDlG9eW+CnRU2LoYgG0RhgNA2hnfX+PdXqVhrccGL3oe/QO4Fvp3XMXiqbhxd8bdXPKqampEkqLe/fu7ezbt689MzNTLn34s4WFhT8ZHx9/bnJy8umDBw8+9elPf3p970q6TjthLAECOQICK8dxx005fPhwe3FxcaoEULkYugRPCaDRC6JXAmhw9OdCR4AuEkCb9n3YdtyLteoL2k7XNW2VaCqEnU6n2bNnT70STXWr1XphaWnp/5TvMtHv959/++23n3r++eePPf7446PXku70dfL1ESBwhQIC6wrhtsJfe+CBB6YmJiYGATR6Cmwlhs6f9hoGUHk32OoYGr1getWF0ZNb4Wv0HH4ucKFTdFvxtgOj1zSN3pdpeHpuo440je7O8Pqmbrf75vLy8tG6rn/cNM2Li4uLz548efKFTqfz2iOPPHLCvhEgQCBLQGBlSa4x5/777x+fmZkp1wBNlXeEDS+ILhdHr5z6esfb4Yexs3LUZ3Cq6yIBVK6A3czXbx3lds/o9zpFt5Wua1rrdgOjF4Kv5zVNF9qIiYmJmJiYOFPX9UutVuu1Vqv10uLi4l+ePXv2haqqXi2/961vfetV7xzbPf+b8pUS2CoCm/kP9KZf5H7fffd1JicnpyYnJwdviS+nwEr8DC9+Xv22+DWuByoBNDgqdIG3xne2ygvteWycwHa6X9NatxwYvQP4er177r1ejVar1XS73Z+12+3yjeBfrev62MLCwl+WaGqa5tWqql6bmZl59Zvf/Obce83y5wQIENgMgR0dWIcOHfpMVVWfiohfWTkatDqGyrt3PAi8p8B2uvXA6Cm60XfQbdTF4OUddN1uN8otCKqqWhgbG6vL/5FptVrz586de7Gu6xPLy8sne73eifn5+XIH6PkSTnVdD8Kp2+2++sgjj5Tf9yBAgMC2FdixgfXggw/+84j46rZ9ZTzxdRfYTtFUMNY6RXeltx0oATSMoMv9b7/ff258fLzcZ+njnU7n9Pz8/O9FxF+0Wq2fjI2NHZuamvqRd9Ct+/r6BAQIbHGBHRlY4mqLb906Pr3tFk0XOkX3k16vvKstfto0sdzpvCuGytGhyw2j0Y8vR5lWPZ6KiFMR8UsRUe70Xr4Z+59FxBtN07w+OTn56oEDBxbX8aUzmgABAjtKYMcF1uc+97m/2zTNf9tRr9Iu/2LWuqapkGzFd9CV51Uq5XRVldNj8Va3G8vtdrTb7Tg+PT2IpqWpqcGPi0VSq9VKedWrqvrvTdPcERE3NE3zR61W6w/LO+jqun59enr69QMHDpxO+USGECBAgMA7BHZcYB06dOjLVVX9rtd56wqM3nLgQje43GrfuLff6cS5vXujarVieWYm+jMzA+DFa66Jemws+t3u4Ocb9PheRHw0Ij4cEU9UVfUH5RRdOdoUEa/Pzs663cAGvRA+DQECBC4ksOMC62KnB8vpo/K293JvnpcWF6O8W8ojR2B4u4EybfTWAlv1KFN5nvVIFPWmp6P8GI2m8vNz11+fA/QeU5qm+eOqqj5Q+Kqqer6u6/9QVdWfl2Aq4TQ7O/tmVVW+Se2GvBo+CQECBK5eYKsE1mciIuW03so7B7+7mqYcNfm92257x28P7iK9tBTl3VXDd1sNLyS+etrtO2F4hKnVbse+sbG4dXJycIprptOJWzqdKKevyumv8t26t9pjK0VTRPzPiCjfsuevRcRPmqb5TxHxP8o1TePj46/fdtttr1dVVW81Q8+HAAECBK5eYDMD6+qf/RoT7r///r0TExNPrFx3cv4j7tu/P37rppsu6XOWI1vl4uNjK0e5hiE2+m09LmnQOn9QCZ33utC5RNHN5RqglQulb1leHsRS+XHN4mKMN80gliYXF2NiYWt+B5ByZGl55ejSQjkl1y3XYEfM33DDeeENPNL0dFVVJyOi3P6jXL/0n5um+W6r1fppOdp0/Pjx17yDbp0X33gCBAhsA4EdF1jF/NChQ+U0y9Oj/uVC6X/5kY+kvSTDu1bP1fXg6NfwMXrfofJ7nW43XlxeXvOC5kt5J9hUqxXXlneUtduDWeUi6W6nE3tPnhwcSRo+Jt8ol9/8/NGdmxv82MqP+ZVTb/2xsVjcv3/wVMu1TMPrmEZP2W3A11Hwno2IT0TEWFVV36rr+tGIeKWcnmu1Wq/Mzs4ubcDz8CkIECBAYIcI7MjAKq/Ngw8+eF+32/0XvV7vbwxfq3v37Inyo8TWhyYmdshLuDW+jGEwlWczejRpM44yDUVWrmsq76C7LiK+ExEPlzuCd7vd17vd7hveQbc1dsezIECAwE4U2LGBNXyxvv/97584derUNeXIz+ojRnvm5mLi1KnB0Z6pN9+M1tJSjJ8qb7Lf3Y/R65i2UjCtvCrlHXTl2yx9KCK+3zTNf6yq6rnh/ZruuuuucvrOgwABAgQIbKrAjg+shx9+uH3w4MGzEXHJh6yGp9iGp43sVBYAABB4SURBVN1KdLVLfJXTcr3epr5gV/LJR48ujV7DNLi2aeV2Axt8m4HRL+N7VVU9W9d1Oa07V1XVN+q6LsE01zTN2V6vd/aee+45dyVft79DgAABAgQ2S2DHB9YQ9ujRo/c2TfPvIuKeq8UuR7rKka/y6Jw9+47rncqRsNHH1R4VW300aTh7NJTK742eitvg65fW4iy3F3isaZryroLXW63W/+v1et/v9/uv3nPPPduvUK92Yfx9AgQIENh1ArsmsFa/sk888cTk3r1772ya5rcj4jd33St/mV9wVVXHIuIb5ahSVVXva5rmWFVV3xsfH/+Jb6FymZg+nAABAgR2vMCuDawLvbJN01RHjhy5udVq/XpE/EZ5c1tEvFyum98B23Ck3MiyHHhrmubJiPj9iDhS7svU7/ff+MQnPvGWm1nugFfZl0CAAAECmy4gsC7zJTh69OhY0zTlBkzlR7nz9i9HxD+MiPdHxI8j4n9FxEOXOfaKPrx8n7mIeLyu6+WqqvZGlO8N3DzVarVei4hy3dnZO+64o1zX5A7gVyTsLxEgQIAAgSsTEFhX5uZvESBAgAABAgQuKCCwLAcBAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAgILDtAgAABAgQIEEgWEFjJoMYRIECAAAECBASWHSBAgAABAgQIJAsIrGRQ4wgQIECAAAECAssOECBAgAABAgSSBQRWMqhxBAgQIECAAAGBZQcIECBAgAABAskCAisZ1DgCBAgQIECAgMCyAwQIECBAgACBZAGBlQxqHAECBAgQIEBAYNkBAgQIECBAgECygMBKBjWOAAECBAgQICCw7AABAgQIECBAIFlAYCWDGkeAAAECBAgQEFh2gAABAgQIECCQLCCwkkGNI0CAAAECBAj8f+Q5aeDphVEcAAAAAElFTkSuQmCC";

    public ArrayList<String> lessons = new ArrayList<>();
    private RestTemplate restTemplate = new RestTemplate();
    private HttpHeaders headers = new HttpHeaders();
    private String currentQuestionId;
    private String currentQuestion;
    private String currentQuestionSign;
    private boolean print = false;

    public KanjiService() {
        getAllLessons();
    }

    /**
     * Gets 5 random questions from the given lesson and returns the first in the list.
     *
     * @param lessonName Name of the lesson to get questions from.
     * @return Returns the first question from the received list.
     * */
    public String getQuestion(String lessonName){
        try {
            ResponseEntity<String> responseEntity = restTemplate.getForEntity(
                    REST_SERVICE_URI+"/api/questions/kanji?lessonName="+lessonName+"&username=test", String.class);
            String formattedQuestion = formatQuestion(responseEntity.getBody().substring(
                    responseEntity.getBody().indexOf("{"), responseEntity.getBody().indexOf("}")+1));

            return formattedQuestion;

        }catch (Exception e){
            System.out.println("Server response: " + e.getMessage());
            e.printStackTrace();
        }

        return null;
    }

    /**
     * Gets all lessons and adds them to an arraylist.
     * */
    private void getAllLessons(){
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(
                REST_SERVICE_URI+"/api/lessons?lessonType=kanji", String.class);
        if(responseEntity.getBody() != null) {
            String[] str = responseEntity.getBody().split("name\":\"");
            for (int i = 1; i < str.length; i++) {
                String str2 = (str[i].substring(0, str[i].indexOf('"')).replace(' ', '_'));
                lessons.add(str2);
            }
        }
    }

    /**
     * Sends back the user answer back to the gakusei application.
     *
     * @param answer The users answer.
     * @return Returns the responseEntity.
     * */
    public ResponseEntity<?> sendAnswer(String answer){
        KanjiDrawingDTO kanjiDrawingDTO = new KanjiDrawingDTO();
        kanjiDrawingDTO.setDifficulty("easy");
        kanjiDrawingDTO.setNuggetid(currentQuestionId);
        kanjiDrawingDTO.setUsername("test");
        kanjiDrawingDTO.setTimestamp(new Date().getTime());
        if(!answer.equals("vetej")){
            kanjiDrawingDTO.setData(data);
        }else{
            kanjiDrawingDTO.setData(null);
        }

        headers.add("Content-Type", "application/json");
        HttpEntity<KanjiDrawingDTO> request = new HttpEntity<KanjiDrawingDTO>(kanjiDrawingDTO, headers);

        return restTemplate.postForEntity(REST_SERVICE_URI+"/api/kanji-drawings",
                request, boolean.class);

    }

    /**
     * Checks if the lesson exists.
     *
     * @param lessonName The name of the lesson to be checked.
     * @return Returns true or false depending on the lessons existence.
     * */
    public boolean isLesson(String lessonName){
        return lessons.contains(lessonName);
    }

    /**
     * Prints all the lesson names.
     * */
    public void printLessons() {
        lessons.forEach(System.out::println);
    }

    /**
     * Formats the question to be ready for printing and sets currentQuestionId,
     * currentQuestion and currentQuestionSign.
     *
     * @param question The question to be formatted.
     * @return Returns a formatted string of the given question.
     * */
    private String formatQuestion(String question){
        currentQuestionId = question.substring(question.indexOf("\":\"")+3, question.indexOf("\",\""));
        currentQuestion = question.substring(question.indexOf("[\""), question.indexOf("],")+1);
        currentQuestionSign = currentQuestion.substring(currentQuestion.indexOf("\",\"")+3,
                currentQuestion.lastIndexOf("\""));
        return "Kanji nugget id: " + currentQuestionId + "\nKanji: " + currentQuestion;
    }

    /**
     *Open the the url of the SVG file in a browser.
     */
    public void showSVG(){
        String hexSign = Integer.toString(currentQuestionSign.codePointAt(0), 16);
        String svg = ("https://staging.daigaku.se/img/kanji/kanjivg/0"+hexSign+".svg");

        if(Desktop.isDesktopSupported()){
            Desktop desktop = Desktop.getDesktop();
            try {
                desktop.browse(new URI(svg));
            } catch (IOException | URISyntaxException e) {
                e.printStackTrace();
            }
        }else{
            Runtime runtime = Runtime.getRuntime();
            try {
                runtime.exec("open " + svg);
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }

    /**
     *Reads the SVG file from the url and prints it to the terminal.
     */
    public void printSVG(){
        try{
            String hexSign = Integer.toString(currentQuestionSign.codePointAt(0), 16);
            URL svg = new URL("https://staging.daigaku.se/img/kanji/kanjivg/0"+hexSign+".svg");
            InputStream in = svg.openConnection().getInputStream();
            InputStreamReader isr = new InputStreamReader(in);
            BufferedReader br = new BufferedReader(isr);
            System.out.println("The SVG for question " + currentQuestion + ":\n");
            while (br.ready()){
                String line = br.readLine();
                if (line.contains("<svg"))
                    print = true;
                if (print)
                    System.out.println(line);
            }
            System.out.println();
            print = false;
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
